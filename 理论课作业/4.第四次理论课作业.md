# 第四次理论课作业

1. ```cpp
   semaphore r_mutex = 1;
   semaphore w_mutex = 1;
   semaphore file_mutex = 1;
   semaphore no_writer = 1;
   int w_cnt = 0;
   int r_cnt = 0;
   
   cobegin
   writer()
   {
       P(w_mutex);
       if (w_cnt == 0)
           P(no_writer);
       w_cnt++;
       V(w_mutex);
   
       P(file_mutex);
       writing();
       V(file_mutex);
   
       P(w_mutex);
       w_cnt--;
       if (w_cnt == 0)
           V(no_writer);
       V(w_mutex);
   }
   
   reader()
   {
       P(no_writer);
       P(r_mutex);
       if (r_cnt == 0)
           P(file_mutex);
       r_cnt++;
       V(r_mutex);
       V(no_writer);
   
       reading();
   
       P(r_mutex);
       r_cnt--;
       if (r_cnt == 0)
           V(file_mutex);
       V(r_mutex);
   }
   coend
   ```
   
2. ```cpp
   semaphore mutex = 1;
   semaphore group = 1;
   semaphore wait = 1;
   int seat = 5;
   
   cobegin
   customer()
   {
       P(wait);
       P(mutex);
       if (seat == 0)
       {
           V(mutex);
           P(group);
           P(mutex);
       }
       seat--;
       V(mutex);
       V(wait);
   
       eat();
   
       P(mutex);
       seat++;
       if (seat == 5)
           V(group);
       V(mutex);
   }
   coend
   ```
   
3. ```cpp
   semaphore mutex = 1;
   semaphore unit = N;
   semaphore odd = 0;
   semaphore even = 0;
   
   cobegin
   P1()
   {
       while (true)
       {
           num = produce();
           P(unit);
           P(mutex);
           put(num);
           V(mutex);
           if (num % 2 == 0)
               V(even);
           else
               V(odd);
       }
   }
   
   P2()
   {
       while (true)
       {
           P(odd);
           P(mutex);
           getodd();
           V(mutex);
           V(unit);
           countodd();
       }
   }
   
   P3()
   {
       while (true)
       {
           P(even);
           P(mutex);
           geteven();
           V(mutex);
           V(unit);
           counteven();
       }
   }
   coend
   ```

4. ```cpp
   semaphore s_mutex = 1;
   semaphore search = 1;
   semaphore insert = 1;
   int s_cnt = 0;
   
   cobegin
   searcher()
   {
       while (true)
       {
           P(s_mutex);
           if (s_cnt == 0)
               P(search);
           s_cnt++;
           V(s_mutex);
   
           searching();
   
           P(s_mutex);
           s_cnt--;
           if (s_cnt == 0)
               V(search);
           V(s_mutex);
       }
   }
   
   inserter()
   {
       while (true)
       {
           P(insert);
           inserting();
           V(insert);
       }
   }
   
   deleter()
   {
       while (true)
       {
           P(search);
           P(insert);
           deleting();
           V(insert);
           V(search);
       }
   }
   coend
   ```
   
   